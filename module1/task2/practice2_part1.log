1. Создайте на сервере для 1 практики ключ ssh
ssh-keygen
cat ~/.ssh/*.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCl48Uv0Id5fL1FZa7tmKkDUgcUeTiOO4XmOY5BteKmNLVniRIfstB/ewfwful2dD9G/SKDzyFL6spXrCBw4HEExOvcC0t/YXL4itkG23JzA/ynhUvq2aMUH7xQFjcs8rAU+Dzz1Oze7/2ZqrZf/xnUB+c7tZUGoYCFK5AbJG3UOJqxY0J5tqrQmqT8yikAnpid6cG8woO/2161XEZa7OjZFPt+h4adHuE7/jiSHvyIieC5kIswYS6EeDnrDpI4+PYOJ3068S7TQOISuU6RBmc2c12eNLccS83GxkL8tDZ6mZm1jUNo+B/wJEappf/ZanRBIvj1NnU8uhI/I1EHYX16ttZ/9oip/b7vJ+9EIYV1qCoRn3NsTyObg2/bfDsZxNawBzIJN53rm6/DwQ4/p/iABs/RTDMbE+XX0+NJ4U2FGl/fvyGpb9I/qBhqWvlRTGRtPrBjgr/rpLBb1802xsHRIsxClQ63xNZMSbhaZ/19UsDNNYschyWbmLmqQ9uxz9s= eltex-pg2-v24@eltex

2. Скопируйте созданный ключ на сервер для 2 практики 
ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.9.224

3. Сравнить содержимое файла открытого ключа на сервере 1 ~/.ssh/*.pub и ~/.ssh/authorized_keys файла на сервере для 2 практики, а также права доступа для каждого
cat ~/.ssh/*.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCl48Uv0Id5fL1FZa7tmKkDUgcUeTiOO4XmOY5BteKmNLVniRIfstB/ewfwful2dD9G/SKDzyFL6spXrCBw4HEExOvcC0t/YXL4itkG23JzA/ynhUvq2aMUH7xQFjcs8rAU+Dzz1Oze7/2ZqrZf/xnUB+c7tZUGoYCFK5AbJG3UOJqxY0J5tqrQmqT8yikAnpid6cG8woO/2161XEZa7OjZFPt+h4adHuE7/jiSHvyIieC5kIswYS6EeDnrDpI4+PYOJ3068S7TQOISuU6RBmc2c12eNLccS83GxkL8tDZ6mZm1jUNo+B/wJEappf/ZanRBIvj1NnU8uhI/I1EHYX16ttZ/9oip/b7vJ+9EIYV1qCoRn3NsTyObg2/bfDsZxNawBzIJN53rm6/DwQ4/p/iABs/RTDMbE+XX0+NJ4U2FGl/fvyGpb9I/qBhqWvlRTGRtPrBjgr/rpLBb1802xsHRIsxClQ63xNZMSbhaZ/19UsDNNYschyWbmLmqQ9uxz9s= eltex-pg2-v24@eltex

cat ~/.ssh/authorized_keys 
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCl48Uv0Id5fL1FZa7tmKkDUgcUeTiOO4XmOY5BteKmNLVniRIfstB/ewfwful2dD9G/SKDzyFL6spXrCBw4HEExOvcC0t/YXL4itkG23JzA/ynhUvq2aMUH7xQFjcs8rAU+Dzz1Oze7/2ZqrZf/xnUB+c7tZUGoYCFK5AbJG3UOJqxY0J5tqrQmqT8yikAnpid6cG8woO/2161XEZa7OjZFPt+h4adHuE7/jiSHvyIieC5kIswYS6EeDnrDpI4+PYOJ3068S7TQOISuU6RBmc2c12eNLccS83GxkL8tDZ6mZm1jUNo+B/wJEappf/ZanRBIvj1NnU8uhI/I1EHYX16ttZ/9oip/b7vJ+9EIYV1qCoRn3NsTyObg2/bfDsZxNawBzIJN53rm6/DwQ4/p/iABs/RTDMbE+XX0+NJ4U2FGl/fvyGpb9I/qBhqWvlRTGRtPrBjgr/rpLBb1802xsHRIsxClQ63xNZMSbhaZ/19UsDNNYschyWbmLmqQ9uxz9s= eltex-pg2-v24@eltex
# Содержимое файлов одинаковое
ls -l ~/.ssh/*.pub
-rw-r--r-- 1 eltex-pg2-v24 eltex-pg2-v24 573 Mar 13 16:27 /home/eltex-pg2-v24/.ssh/id_rsa.pub

ls -l ~/.ssh/authorized_keys
-rw------- 1 root root 573 Mar 13 09:33 /root/.ssh/authorized_keys
#права разные 
для 1 обычный файл, владелец может читать и писать, группа и остальные только читать
для 2 обычный файл, владелец может читать и писать, группа и остальные не имеют доступа

4. Создайте пользователя user1 при помощи команды useradd, укажите необходимость домашнего каталога и shell /bin/bash
useradd -m -s /bin/bash user1
passwd user1

5. Создайте пользователя user2 и user3 при помощи команды adduser
adduser user2
adduser user3
info: Adding user `user2' ...
info: Selecting UID/GID from range 1000 to 59999 ...
info: Adding new group `user2' (1005) ...
info: Adding new user `user2' (1005) with group `user2 (1005)' ...
info: Creating home directory `/home/user2' ...
info: Copying files from `/etc/skel' ...
New password: 
Retype new password: 
passwd: password updated successfully
Changing the user information for user2
Enter the new value, or press ENTER for the default
	Full Name []: USER2
	Room Number []: 
	Work Phone []: 
	Home Phone []: 
	Other []: 
Is the information correct? [Y/n] Y
info: Adding new user `user2' to supplemental / extra groups `users' ...
info: Adding user `user2' to group `users' ...

6. Для пользователя user3 смените shell на /usr/sbin/nologin (man usermod), выполните при помощи su, сначала без, затем с доп. параметрами shell /bin/bash. Выполните logout.  
usermod -s /usr/sbin/nologin user3
su user3
This account is currently not available.
su -s /bin/bash user3
user3@eltex-practice2-pg2-v24:/root$ logout
bash: logout: not login shell: use `exit'
exit

7.Создайте новую группу и добавьте её для всех пользователей user* как дополнительную, посмотрите список групп всех пользователей user*.
groupadd usersgroup1
man usermod
usermod -a -G usersgroup1 user1
usermod -a -G usersgroup1 user2
usermod -a -G usersgroup1 user3
id -Gn user1
user1 usersgroup1
id -Gn user2
user2 users usersgroup1
id -Gn user3
user3 users usersgroup1

9.Создайте каталог /opt/share и назначьте группу из предыдущего пункта его владельцем, установите на этот каталог бит SGID, права для группы rwx.
mkdir /opt/share
chown :usersgroup1 /opt/share
chmod g+s /opt/share
chmod g+rwx /opt/share
ls -ld /opt/share
drwxrwsr-x  2 root usersgroup1 4096 Mar 16 12:09 /opt/share

10. Для user1 задайте перманентно umask, снимающий право чтения для "прочих"
su user1
vim ~/.bashrc
umask 026 #добавляем в конец строчку
source ~/.bashrc
exit

11.Создайте каждым из пользователей новые файлы в каталоге /opt/share, удалите файлы созданные другими пользователями
su user1
touch /opt/share/user1.txt
exit
su user2
rm /opt/share/user1.txt
rm: remove write-protected regular empty file '/opt/share/user1.txt'? Y 
touch /opt/share/user2.txt
exit
su -s /bin/bash user3
rm /opt/share/user2.txt
touch /opt/share/user3.txt
exit
su user1
rm /opt/share/user3.txt
exit

12.Повторите предыдуший пункт, предварительно установив sticky bit на каталоге /opt/share
chmod +t /opt/share
ls -ld /opt/share
drwxrwsr-t 2 root usersgroup1 4096 Mar 16 12:09 /opt/share
su user1
touch /opt/share/user1.txt
exit
su user2
rm opt/share/user1.txt
rm: remove write-protected regular empty file '/opt/share/user1.txt'? Y
rm: cannot remove '/opt/share/user1.txt': Operation not permitted
touch /opt/share/user2.txt
exit
su -s /bin/bash user3
rm: cannot remove '/opt/share/user2.txt': Operation not permitted
touch /opt/share/user3.txt
exit
su user1
rm: cannot remove '/opt/share/user3.txt': Operation not permitted
exit

13. Разрешите user1 выполнять привилегированную команду dmesg при помощи команды sudo, а user2 при помощи скрипта на языке bash с флагом SUID
visudo
# User privilege specification
root    ALL=(ALL:ALL) ALL
user1   ALL=(ALL) NOPASSWD: /bin/dmesg #добавили эту строчку
su user1
sudo dmesg | tail -5
[648762.183133] audit: type=1400 audit(1742458638.986:822): apparmor="DENIED" operation="mknod" class="file" profile="ubuntu_pro_esm_cache" name="/usr/lib/python3/dist-packages/uaclient/__pycache__/secret_manager.cpython-312.pyc.138951844517808" pid=22573 comm="python3" requested_mask="c" denied_mask="c" fsuid=0 ouid=0
[648762.186640] audit: type=1400 audit(1742458638.989:823): apparmor="DENIED" operation="mknod" class="file" profile="ubuntu_pro_esm_cache" name="/usr/lib/python3/dist-packages/uaclient/__pycache__/system.cpython-312.pyc.138951844519856" pid=22573 comm="python3" requested_mask="c" denied_mask="c" fsuid=0 ouid=0
[648762.193875] audit: type=1400 audit(1742458638.997:824): apparmor="DENIED" operation="mknod" class="file" profile="ubuntu_pro_esm_cache" name="/usr/lib/python3/dist-packages/uaclient/__pycache__/exceptions.cpython-312.pyc.138951844965808" pid=22573 comm="python3" requested_mask="c" denied_mask="c" fsuid=0 ouid=0
[648762.198495] audit: type=1400 audit(1742458639.001:825): apparmor="DENIED" operation="mknod" class="file" profile="ubuntu_pro_esm_cache" name="/usr/lib/python3/dist-packages/uaclient/messages/__pycache__/__init__.cpython-312.pyc.138951843741232" pid=22573 comm="python3" requested_mask="c" denied_mask="c" fsuid=0 ouid=0
[648762.199275] audit: type=1400 audit(1742458639.002:826): apparmor="DENIED" operation="mknod" class="file" profile="ubuntu_pro_esm_cache" name="/usr/lib/python3/dist-packages/uaclient/messages/__pycache__/urls.cpython-312.pyc.138951843741232" pid=22573 comm="python3" requested_mask="c" denied_mask="c" fsuid=0 ouid=0
exit
nano /usr/local/bin/dmesg_script.sh
!/bin/bash #добавляем эти две строчки
/bin/dmesg #выходим
chmod +x /usr/local/bin/dmesg_script.sh
chmod u+s /usr/local/bin/dmesg_script.sh
ls -l /usr/local/bin/dmesg_script.sh
chown root:user2 /usr/local/bin/dmesg_script.sh
chmod 750 /usr/local/bin/dmesg_script.sh
sysctl kernel.dmesg_restrict
sysctl -w kernel.dmesg_restrict=0
ls -l /usr/local/bin/dmesg_script.sh
-rwxr-x--- 1 root user2 24 Mar 16 12:30 /usr/local/bin/dmesg_script.sh
su user2
/usr/local/bin/dmesg_script.sh | tail -5
[648762.183133] audit: type=1400 audit(1742458638.986:822): apparmor="DENIED" operation="mknod" class="file" profile="ubuntu_pro_esm_cache" name="/usr/lib/python3/dist-packages/uaclient/__pycache__/secret_manager.cpython-312.pyc.138951844517808" pid=22573 comm="python3" requested_mask="c" denied_mask="c" fsuid=0 ouid=0
[648762.186640] audit: type=1400 audit(1742458638.989:823): apparmor="DENIED" operation="mknod" class="file" profile="ubuntu_pro_esm_cache" name="/usr/lib/python3/dist-packages/uaclient/__pycache__/system.cpython-312.pyc.138951844519856" pid=22573 comm="python3" requested_mask="c" denied_mask="c" fsuid=0 ouid=0
[648762.193875] audit: type=1400 audit(1742458638.997:824): apparmor="DENIED" operation="mknod" class="file" profile="ubuntu_pro_esm_cache" name="/usr/lib/python3/dist-packages/uaclient/__pycache__/exceptions.cpython-312.pyc.138951844965808" pid=22573 comm="python3" requested_mask="c" denied_mask="c" fsuid=0 ouid=0
[648762.198495] audit: type=1400 audit(1742458639.001:825): apparmor="DENIED" operation="mknod" class="file" profile="ubuntu_pro_esm_cache" name="/usr/lib/python3/dist-packages/uaclient/messages/__pycache__/__init__.cpython-312.pyc.138951843741232" pid=22573 comm="python3" requested_mask="c" denied_mask="c" fsuid=0 ouid=0
[648762.199275] audit: type=1400 audit(1742458639.002:826): apparmor="DENIED" operation="mknod" class="file" profile="ubuntu_pro_esm_cache" name="/usr/lib/python3/dist-packages/uaclient/messages/__pycache__/urls.cpython-312.pyc.138951843741232" pid=22573 comm="python3" requested_mask="c" denied_mask="c" fsuid=0 ouid=0
exit

14.Для всех пользователей user* задайте время действия пароля - 10 дней
for user in $(getent passwd | grep '^user' | cut -d: -f1); do chage -M 10 "$user"; done
chage -l user1
Last password change					: Mar 13, 2025
Password expires					: Mar 23, 2025
Password inactive					: never
Account expires						: never
Minimum number of days between password change		: 0
Maximum number of days between password change		: 10
Number of days of warning before password expires	: 0

15. Отредактируйте файл /etc/motd, вписав туда свое имя и фамилию
vim /etc/motd
Ольга Торопова #добавила строчку

16. Создайте копию содержимого каталога /etc в каталог /root/etc_backup при помощи программы rcync
rsync -av /etc/ /root/etc_backup/
sending incremental file list
created directory /root/etc_backup
...
sent 69,650 bytes  received 260 bytes  139,820.00 bytes/sec
total size is 2,362,202  speedup is 33.79

17. Заархивируйте содержимое каталога /root/etc_backup архиватором tar, используйте алгоритмы сжатия gzip, bzip2, 7zip, сравните размеры полученных файлов
tar -czf /root/etc_backup.tar.gz -C /root etc_backup/
tar -cjf /root/etc_backup.tar.bz2 -C /root etc_backup/
tar -cf - -C /root etc_backup | 7z a -si /root/etc_backup.tar.7z
ls -lh /root/etc_backup.tar.*
-rw-r--r-- 1 root root 475K Mar 16 14:08 /root/etc_backup.tar.7z
-rw-r--r-- 1 root root 548K Mar 16 14:03 /root/etc_backup.tar.bz2
-rw-r--r-- 1 root root 582K Mar 16 14:02 /root/etc_backup.tar.gz

18.Отредактируйте файл /etc/motd, вписав туда текущую дату и время, синхронизируйте каталог /root/etc_backup с каталогом /etc при помощи rsync, добавьте файл motd в архив, сжатый gzip
date >> /etc/motd
rsync -av --delete /etc/ /root/etc_backup/
tar -czf /root/etc_back.tar.gz -C /etc motd
mkdir /root/2_backup
tar -xzf /root/etc_backup.tar.gz -C /root/2_backup/ 
cp /etc/motd /root/2_backup/
tar -czf /root/etc_backup2.tar.gz -C /root 2_backup/
rm -rf /root/2_backup/

19. Сравните содержимое архива, упакованного bzip2 с содержимым каталога /root/etc_backup
1 способ:
root@eltex-practice2-pg2-v24:~# tar -df /root/etc_backup.tar.bz2 -C /root etc_backup
etc_backup/gshadow-: Mod time differs
etc_backup/gshadow-: Size differs
etc_backup/passwd: Mod time differs
etc_backup/passwd: Size differs
etc_backup/group: Mod time differs
etc_backup/group: Size differs
etc_backup/passwd-: Mod time differs
etc_backup/passwd-: Size differs
etc_backup/group-: Mod time differs
etc_backup/group-: Size differs
etc_backup/shadow-: Mod time differs
etc_backup/shadow-: Size differs
tar: etc_backup/.motd.swp: Warning: Cannot stat: No such file or directory
etc_backup/shadow: Mod time differs
etc_backup/shadow: Size differs
etc_backup/gshadow: Mod time differs
etc_backup/gshadow: Size differs
etc_backup/subuid: Mod time differs
etc_backup/subuid: Size differs
etc_backup/motd: Mod time differs
etc_backup/motd: Size differs
etc_backup/subgid-: Mod time differs
etc_backup/subgid-: Size differs
etc_backup/subgid: Mod time differs
etc_backup/subgid: Size differs
etc_backup/subuid-: Mod time differs
etc_backup/subuid-: Size differs
2 способ:
mkdir /root/etc_backupbzip2
tar -xjf /root/etc_backup.tar.bz2 -C /root/etc_backupbzip2
diff -r /root/etc_backup /root/etc_backupbzip2/etc_backup | tail -10
diff: /root/etc_backup/mtab: No such file or directory
diff: /root/etc_backupbzip2/etc_backup/mtab: No such file or directory
diff: /root/etc_backup/os-release: No such file or directory
diff: /root/etc_backupbzip2/etc_backup/os-release: No such file or directory
diff: /root/etc_backup/resolv.conf: No such file or directory
diff: /root/etc_backupbzip2/etc_backup/resolv.conf: No such file or directory
diff -r /root/etc_backup/subuid /root/etc_backupbzip2/etc_backup/subuid
5,7d4
< user4:362144:65536
< user5:427680:65536
< user6:493216:65536
diff -r /root/etc_backup/subuid- /root/etc_backupbzip2/etc_backup/subuid-
4,6d3
< user3:296608:65536
< user4:362144:65536
< user5:427680:65536

20.Распакуйте архивы etc_backup, упакованные gzip и 7zip, сравните diff motd
mkdir /root/etc_backup_gzip
mkdir /root/etc_backup_7zip
tar -xzf /root/etc_backup.tar.gz -C /root/etc_backup_gzip
7z x /root/etc_backup.tar.7z -o/root/etc_backup_7zip
tar -xvf /root/etc_backup_7zip/etc_backup.tar -C /root/etc_backup_7zip
diff /root/etc_backup_gzip/etc_backup/motd /root/etc_backup_7zip/etc_backup/motd2,4c2
<  
< Sun Mar 16 02:22:31 PM UTC 2025
---
> 
                                     
